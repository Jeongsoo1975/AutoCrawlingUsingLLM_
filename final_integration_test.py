# final_integration_test.py\n\"\"\"\nìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ - ëª¨ë“  ê°œì„ ì‚¬í•­ ê²€ì¦\n\"\"\"\nimport asyncio\nimport logging\nimport os\nimport sys\nimport time\nfrom config import settings\nfrom utils.logger import setup_logger\nfrom utils.error_handler import create_error_report, save_error_log\n\n# ë¡œê±° ì„¤ì •\nsetup_logger()\nlogger = logging.getLogger(__name__)\n\nclass IntegrationTestSuite:\n    def __init__(self):\n        self.test_results = {}\n        self.errors = []\n        \n    async def run_all_tests(self):\n        \"\"\"ëª¨ë“  í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰\"\"\"\n        logger.info(\"=== ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘ ===\\n\")\n        \n        test_methods = [\n            self.test_llm_connection,\n            self.test_web_search,\n            self.test_browser_controller,\n            self.test_pipeline_initialization,\n            self.test_error_handling\n        ]\n        \n        for test_method in test_methods:\n            test_name = test_method.__name__\n            try:\n                logger.info(f\"ğŸ§ª ì‹¤í–‰ ì¤‘: {test_name}\")\n                result = await test_method()\n                self.test_results[test_name] = result\n                status = \"âœ… ì„±ê³µ\" if result else \"âŒ ì‹¤íŒ¨\"\n                logger.info(f\"{test_name}: {status}\\n\")\n            except Exception as e:\n                self.test_results[test_name] = False\n                error_report = create_error_report(e, {\"test\": test_name})\n                self.errors.append(error_report)\n                logger.error(f\"âŒ {test_name} ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜: {e}\\n\")\n        \n        return self.generate_final_report()\n    \n    async def test_llm_connection(self):\n        \"\"\"LLM ì—°ê²° í…ŒìŠ¤íŠ¸\"\"\"\n        try:\n            from core.llm_handler import LLMHandler\n            \n            llm = LLMHandler()\n            messages = [{\"role\": \"user\", \"content\": \"ê°„ë‹¨í•œ ì—°ê²° í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. 'ì—°ê²° ì„±ê³µ'ì´ë¼ê³  ë‹µë³€í•´ì£¼ì„¸ìš”.\"}]\n            \n            response = await llm.chat_completion(messages)\n            \n            if response and \"ì—°ê²°\" in response:\n                logger.info(f\"LLM ì‘ë‹µ: {response[:100]}...\")\n                return True\n            else:\n                logger.warning(f\"ì˜ˆìƒê³¼ ë‹¤ë¥¸ LLM ì‘ë‹µ: {response}\")\n                return False\n                \n        except Exception as e:\n            logger.error(f\"LLM ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    async def test_web_search(self):\n        \"\"\"ì›¹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸\"\"\"\n        try:\n            from core.web_searcher import WebSearcher\n            \n            searcher = WebSearcher()\n            results = searcher.search_links(\"python programming\")\n            \n            if results and len(results) > 0:\n                logger.info(f\"ê²€ìƒ‰ ê²°ê³¼ {len(results)}ê°œ ë°œê²¬\")\n                logger.info(f\"ì²« ë²ˆì§¸ ê²°ê³¼: {results[0]['title'][:50]}...\")\n                return True\n            else:\n                logger.warning(\"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŒ\")\n                return False\n                \n        except Exception as e:\n            logger.error(f\"ì›¹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    async def test_browser_controller(self):\n        \"\"\"ë¸Œë¼ìš°ì € ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸\"\"\"\n        try:\n            from core.browser_controller import BrowserController\n            \n            browser = BrowserController()\n            result = await browser.browse_website(\n                url=\"https://httpbin.org/html\",\n                action=None,\n                close_browser=True\n            )\n            \n            if result.get(\"status\") == \"success\":\n                logger.info(f\"ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ì„±ê³µ: {result.get('page_title', 'No title')}\")\n                return True\n            else:\n                logger.warning(f\"ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {result.get('error_message')}\")\n                return False\n                \n        except Exception as e:\n            logger.error(f\"ë¸Œë¼ìš°ì € ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    async def test_pipeline_initialization(self):\n        \"\"\"íŒŒì´í”„ë¼ì¸ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸\"\"\"\n        try:\n            from pipelines.agent_pipeline import AgentPipeline\n            \n            # ìƒíƒœ ì½œë°± í•¨ìˆ˜\n            def test_callback(message):\n                logger.debug(f\"[PIPELINE_CALLBACK] {message}\")\n            \n            pipeline = AgentPipeline(streamlit_status_callback=test_callback)\n            \n            # íŒŒì´í”„ë¼ì¸ ê°ì²´ì˜ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸\n            if (hasattr(pipeline, 'llm_handler') and \n                hasattr(pipeline, 'web_searcher') and \n                hasattr(pipeline, 'browser_controller') and\n                hasattr(pipeline, 'data_extractor') and\n                hasattr(pipeline, 'excel_writer')):\n                logger.info(\"íŒŒì´í”„ë¼ì¸ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™” ì„±ê³µ\")\n                return True\n            else:\n                logger.warning(\"íŒŒì´í”„ë¼ì¸ ì¼ë¶€ ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨\")\n                return False\n                \n        except Exception as e:\n            logger.error(f\"íŒŒì´í”„ë¼ì¸ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    async def test_error_handling(self):\n        \"\"\"ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸\"\"\"\n        try:\n            from utils.error_handler import handle_async_errors, safe_execute_async\n            \n            # ì˜ë„ì ìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ëŠ” í•¨ìˆ˜\n            @handle_async_errors(default_return=\"error_handled\")\n            async def failing_function():\n                raise ValueError(\"Test error\")\n            \n            result = await failing_function()\n            \n            if result == \"error_handled\":\n                logger.info(\"ì˜¤ë¥˜ ì²˜ë¦¬ ë°ì½”ë ˆì´í„° ì‘ë™ í™•ì¸\")\n                return True\n            else:\n                logger.warning(f\"ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì˜¤ë¥˜ ì²˜ë¦¬ ê²°ê³¼: {result}\")\n                return False\n                \n        except Exception as e:\n            logger.error(f\"ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}\")\n            return False\n    \n    def generate_final_report(self):\n        \"\"\"ìµœì¢… í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ ìƒì„±\"\"\"\n        logger.info(\"=== ìµœì¢… í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ ===\")\n        \n        total_tests = len(self.test_results)\n        passed_tests = sum(1 for result in self.test_results.values() if result)\n        failed_tests = total_tests - passed_tests\n        \n        logger.info(f\"ì´ í…ŒìŠ¤íŠ¸: {total_tests}\")\n        logger.info(f\"ì„±ê³µ: {passed_tests}\")\n        logger.info(f\"ì‹¤íŒ¨: {failed_tests}\")\n        logger.info(f\"ì„±ê³µë¥ : {(passed_tests/total_tests)*100:.1f}%\")\n        \n        logger.info(\"\\n=== ê°œë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===\")\n        for test_name, result in self.test_results.items():\n            status = \"âœ…\" if result else \"âŒ\"\n            logger.info(f\"{status} {test_name}\")\n        \n        if self.errors:\n            logger.info(f\"\\n=== ì˜¤ë¥˜ ë³´ê³ ì„œ ({len(self.errors)}ê°œ) ===\")\n            for i, error in enumerate(self.errors, 1):\n                logger.error(f\"ì˜¤ë¥˜ {i}: {error['error_type']} - {error['error_message']}\")\n                save_error_log(error, f\"integration_test_error_{i}.log\")\n        \n        success_rate = (passed_tests / total_tests) * 100\n        overall_success = success_rate >= 80.0  # 80% ì´ìƒ ì„±ê³µ ì‹œ ì „ì²´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼\n        \n        if overall_success:\n            logger.info(\"\\nğŸ‰ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ì„±ê³µ!\")\n        else:\n            logger.error(\"\\nğŸ’¥ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!\")\n        \n        return overall_success\n\nasync def main():\n    \"\"\"ë©”ì¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í•¨ìˆ˜\"\"\"\n    test_suite = IntegrationTestSuite()\n    success = await test_suite.run_all_tests()\n    \n    return success\n\nif __name__ == \"__main__\":\n    result = asyncio.run(main())\n    sys.exit(0 if result else 1)\n